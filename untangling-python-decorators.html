<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="google-site-verification" content="<meta name='google-site-verification' content='N5QEPRj-LpgoEY0Hf3uVMmZq8kjDwTFjd54IgvLmRBc' />" />        <meta name="author" content="Redowan Delowar" />

        <meta name="description" content="Updated on 2022-02-13: Change functools import style. When I first learned about Python decorators, using them felt like doing voodoo magic. Decorators can give you the ability to add new functionalities to any callable without actually touching or changing the code inside it. This can typically yield better encapsulation and …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, python, " />

<meta property="og:title" content="Untangling Python decorators "/>
<meta property="og:url" content="./untangling-python-decorators.html" />
<meta property="og:description" content="Updated on 2022-02-13: Change functools import style. When I first learned about Python decorators, using them felt like doing voodoo magic. Decorators can give you the ability to add new functionalities to any callable without actually touching or changing the code inside it. This can typically yield better encapsulation and …" />
<meta property="og:site_name" content="Redowan&#39;s Reflections" />
<meta property="og:article:author" content="Redowan Delowar" />
<meta property="og:article:published_time" content="2020-05-13T00:00:00+06:00" />
<meta name="twitter:title" content="Untangling Python decorators ">
<meta name="twitter:description" content="Updated on 2022-02-13: Change functools import style. When I first learned about Python decorators, using them felt like doing voodoo magic. Decorators can give you the ability to add new functionalities to any callable without actually touching or changing the code inside it. This can typically yield better encapsulation and …">
<meta property="og:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" />
<meta name="twitter:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" >

        <title>Untangling Python decorators  · Redowan&#39;s Reflections
</title>
        <link href="https://rednafi.github.io/reflections/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Redowan&#39;s Reflections - Full Atom Feed" />

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-217287505-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>Redowan's Reflections</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./pages/contact.html">Contact</a></li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li>
                                  <form action="https://www.google.com/search" class="navbar-search" method="get" name="searchform" target="_blank">
                                    <input name="sitesearch" type="hidden"
                                    value="rednafi.github.io/reflections">
                                    <input autocomplete="on" class="search-query" name="q" placeholder="Search"
                                    required="required"  type="text">
                                    <input type="submit" value="Search" style="visibility: hidden;" /></form>
                                  </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./untangling-python-decorators.html">
                Untangling Python decorators
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p><strong><em>Updated on 2022-02-13</em></strong>: <em>Change functools import style.</em></p>
<p>When I first learned about Python decorators, using them felt like doing voodoo magic.
Decorators can give you the ability to add new functionalities to any callable without
actually touching or changing the code inside it. This can typically yield better
encapsulation and help you write cleaner and more understandable code. However,
<em>decorator</em> is considered as a fairly advanced topic in Python since understanding and
writing it requires you to have command over multiple additional concepts like first
class objects, higher order functions, closures etc. First, I'll try to introduce these
concepts as necessary and then unravel the core concept of decorator layer by layer. So
let's dive in.</p>
<h2>First class objects</h2>
<p>In Python, basically everything is an object and functions are regarded as first-class
objects. It means that functions can be passed around and used as arguments, just like
any other object (string, int, float, list, and so on). You can assign functions to
variables and treat them like any other objects. Consider this example:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">func_a</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;I was angry with my friend.&quot;</span>


<span class="k">def</span> <span class="nf">func_b</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;I told my wrath, my wrath did end&quot;</span>


<span class="k">def</span> <span class="nf">func_c</span><span class="p">(</span><span class="o">*</span><span class="n">funcs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">())</span>


<span class="n">main_func</span> <span class="o">=</span> <span class="n">func_c</span>
<span class="n">main_func</span><span class="p">(</span><span class="n">func_a</span><span class="p">,</span> <span class="n">func_b</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nv">I</span> <span class="nv">was</span> <span class="nv">angry</span> <span class="nv">with</span> <span class="nv">my</span> <span class="nv">friend</span>.
<span class="o">&gt;&gt;&gt;</span> <span class="nv">I</span> <span class="nv">told</span> <span class="nv">my</span> <span class="nv">wrath</span>, <span class="nv">my</span> <span class="nv">wrath</span> <span class="nv">did</span> <span class="k">end</span>
</code></pre></div>

<p>The above example demonstrates how Python treats functions as first class citizens.
First, I defined two functions, <code>func_a</code> and <code>func_b</code> and then <code>func_c</code> takes them as
parameters. <code>func_c</code> runs the functions taken as parameters and prints the results.
Then we assign <code>func_c</code> to variable <code>main_func</code>. Finally, we run <code>main_func</code> and it
behaves just like <code>func_c</code>.</p>
<h2>Higher order functions</h2>
<p>Python also allows you to use functions as return values. You can take in another
function and return that function or you can define a function within another function
and return the inner function.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">higher</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a higher order function.</span>
<span class="sd">    It returns another function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">lower</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;I&#39;m hunting high and low&quot;</span>


<span class="n">higher</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &lt;function __main__.lower()&gt;
</code></pre></div>

<p>Now you can assign the result of <code>higher</code> to another variable and execute the output
function.</p>
<div class="highlight"><pre><span></span><code><span class="n">h</span> <span class="o">=</span> <span class="n">higher</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
<span class="n">h</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &quot;I&#39;m hunting high and low&quot;
</code></pre></div>

<p>Let's look into another example where you can define a nested function within a
function and return the nested function instead of its result.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Define and return a nested function from another function.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="s2">&quot;Hello from the inner func&quot;</span>

    <span class="k">return</span> <span class="n">inner</span>


<span class="n">inn</span> <span class="o">=</span> <span class="n">outer</span><span class="p">()</span>
<span class="n">inn</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;Hello from the inner func&#39;
</code></pre></div>

<p>Notice how the nested function <code>inner</code> was defined inside the <code>outer</code> function and then
the return statement of the <code>outer</code> function returned the nested function. After
definition, to get to the nested function, first we called the <code>outer</code> function and
received the result as another function. Then executing the result of the <code>outer</code>
function prints out the message from the <code>inner</code> function.</p>
<h2>Closures</h2>
<p>You saw examples of inner functions at work in the previous section. Nested functions
can access variables of the enclosing scope. In Python, these non-local variables are
read only by default and we must declare them explicitly as non-local (using <code>nonlocal</code>
keyword) in order to modify them. Following is an example of a nested function
accessing a non-local variable.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">burger</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ingredients</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;deli&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;steak&quot;</span><span class="p">,</span> <span class="s2">&quot;pastrami&quot;</span><span class="p">,</span> <span class="s2">&quot;emmental&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;smashed&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;chicken&quot;</span><span class="p">,</span> <span class="s2">&quot;nacho cheese&quot;</span><span class="p">,</span> <span class="s2">&quot;jalapeno&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">ingredients</span>
</code></pre></div>

<p>Now run the function,</p>
<div class="highlight"><pre><span></span><code><span class="n">ingr</span> <span class="o">=</span> <span class="n">burger</span><span class="p">(</span><span class="s2">&quot;deli&quot;</span><span class="p">)</span>
<span class="n">ingr</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; (&#39;steak&#39;, &#39;pastrami&#39;, &#39;emmental&#39;)
</code></pre></div>

<p>Well, that's unusual.</p>
<p>The <code>burger</code> function was called with the string <code>deli</code> and the returned function was
bound to the name <code>ingr</code>. On calling <code>ingr()</code>, the message was still remembered and
used to derive the outcome although the outer function <code>burger</code> had already finished
its execution.</p>
<p>This technique by which some data ("deli") gets attached to the code is called closure
in Python. The value in the enclosing scope is remembered even when the variable goes
out of scope or the function itself is removed from the current namespace. Decorators
uses the idea of non-local variables multiple times and soon you'll see how.</p>
<h2>Writing a basic decorator</h2>
<p>With these prerequisites out of the way, let's go ahead and create your first simple
decorator.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will get printed before the function is called.&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will get printed after the function is called.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>

<p>Before using the decorator, let's define a simple function without any parameters.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ans</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div>

<p>Treating the functions as first-class objects, you can use your decorator like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">ans</span> <span class="o">=</span> <span class="n">deco</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
<span class="n">ans</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; This will get printed before the function is called.
    42
    This will get printed after the function is called.
</code></pre></div>

<p>In the above two lines, you can see a very simple decorator in action. Our <code>deco</code>
function takes in a target function, manipulates the target function inside a <code>wrapper</code>
function and then returns the <code>wrapper</code> function. Running the function returned by the
decorator, you will get your modified result. To put it simply, decorators wraps a
function and modifies its behavior.</p>
<blockquote>
<p>The decorator function runs at the time the decorated function is imported/defined,
not when it is called.</p>
</blockquote>
<p>Before moving onto the next section, let's see how we can get the return value of
target function instead of just printing it.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This modified decorator also returns the result of func.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will get printed before the function is called.&quot;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will get printed after the function is called.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">ans</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">42</span>
</code></pre></div>

<p>In the above example, the wrapper function returns the result of the target function
and the wrapper itself. This makes it possible to get the result of the modified
function.</p>
<div class="highlight"><pre><span></span><code><span class="n">ans</span> <span class="o">=</span> <span class="n">deco</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ans</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; This will get printed before the function is called.
    This will get printed after the function is called.
    42
</code></pre></div>

<p>Can you guess why the return value of the decorated function appeared in the last line
instead of in the middle like before?</p>
<h2>The @ syntactic sugar</h2>
<p>The way you've used decorator in the last section might feel a little clunky. First,
you have to type the name <code>ans</code> three times to call and use the decorator. Also, it
becomes harder to tell apart where the decorator is actually working. So Python allows
you to use decorator with the special syntax <code>@</code>. You can apply your decorators while
defining your functions, like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@deco</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="o">...</span>


<span class="c1"># Now call your decorated function just like a normal one</span>
<span class="n">func</span><span class="p">()</span>
</code></pre></div>

<p>Sometimes the above syntax is called the <strong>pie syntax</strong> and it's just a syntactic sugar
for <code>func = deco(func)</code>.</p>
<h2>Decorating functions with arguments</h2>
<p>The naive decorator that we've implemented above will only work for functions that take
no arguments. It'll fail and raise <code>TypeError</code> if your try to decorate a function
having arguments with <code>deco</code>. Now let's create another decorator called <code>yell</code> which
will take in a function that returns a string value and transform that string value to
uppercase.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">yell</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>

<p>Create the target function that returns string value.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@yell</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;redowan&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;HELLO REDOWAN!&#39;
</code></pre></div>

<p>Function <code>hello</code> takes a <code>name:string</code> as parameter and returns a message as string.
Look how the <code>yell</code> decorator is modifying the original return string, transforming
that to uppercase and adding an extra <code>!</code> sign without directly changing any code in
the <code>hello</code> function.</p>
<h2>Solving identity crisis</h2>
<p>In Python, you can introspect any object and its properties via the interactive shell.
A function knows its identity, docstring etc. For instance, you can inspect the built
in <code>print</code> function in the following ways:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &lt;function print&gt;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;print&#39;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="o">.</span><span class="vm">__doc__</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="s2">&quot;print(value, ..., sep=&#39; &#39;, end=&#39;\\n&#39;, file=sys.stdout, flush=False)\n\nPrints the</span>
<span class="s2">values to a stream, or to sys.stdout by default.\nOptional keyword arguments:\nfile:  a</span>
<span class="s2">file-like object (stream); defaults to the current sys.stdout.\nsep:   string inserted</span>
<span class="s2">between values, default a space.\nend:   string appended after the last value, default</span>
<span class="s2">a newline.\nflush: whether to forcibly flush the stream.&quot;</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">help</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nt">Help</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">built-in</span><span class="w"> </span><span class="nt">function</span><span class="w"> </span><span class="nt">print</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">module</span><span class="w"> </span><span class="nt">builtins</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="nt">print</span><span class="o">(...)</span><span class="w"></span>
<span class="w">    </span><span class="nt">print</span><span class="o">(</span><span class="nt">value</span><span class="o">,</span><span class="w"> </span><span class="o">...,</span><span class="w"> </span><span class="nt">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">end</span><span class="o">=</span><span class="s1">&#39;\n&#39;</span><span class="o">,</span><span class="w"> </span><span class="nt">file</span><span class="o">=</span><span class="nt">sys</span><span class="p">.</span><span class="nc">stdout</span><span class="o">,</span><span class="w"> </span><span class="nt">flush</span><span class="o">=</span><span class="nt">False</span><span class="o">)</span><span class="w"></span>

<span class="w">    </span><span class="nt">Prints</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">values</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">stream</span><span class="o">,</span><span class="w"> </span><span class="nt">or</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">sys</span><span class="p">.</span><span class="nc">stdout</span><span class="w"> </span><span class="nt">by</span><span class="w"> </span><span class="nt">default</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">Optional</span><span class="w"> </span><span class="nt">keyword</span><span class="w"> </span><span class="nt">arguments</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">file</span><span class="o">:</span><span class="w">  </span><span class="nt">a</span><span class="w"> </span><span class="nt">file-like</span><span class="w"> </span><span class="nt">object</span><span class="w"> </span><span class="o">(</span><span class="nt">stream</span><span class="o">);</span><span class="w"> </span><span class="nt">defaults</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">current</span><span class="w"> </span><span class="nt">sys</span><span class="p">.</span><span class="nc">stdout</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">sep</span><span class="o">:</span><span class="w">   </span><span class="nt">string</span><span class="w"> </span><span class="nt">inserted</span><span class="w"> </span><span class="nt">between</span><span class="w"> </span><span class="nt">values</span><span class="o">,</span><span class="w"> </span><span class="nt">default</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">space</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">end</span><span class="o">:</span><span class="w">   </span><span class="nt">string</span><span class="w"> </span><span class="nt">appended</span><span class="w"> </span><span class="nt">after</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">last</span><span class="w"> </span><span class="nt">value</span><span class="o">,</span><span class="w"> </span><span class="nt">default</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">newline</span><span class="o">.</span><span class="w"></span>
<span class="w">    </span><span class="nt">flush</span><span class="o">:</span><span class="w"> </span><span class="nt">whether</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">forcibly</span><span class="w"> </span><span class="nt">flush</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">stream</span><span class="o">.</span><span class="w"></span>
</code></pre></div>

<p>This introspection works similarly for functions that you defined yourself. I'll be
using the previously defined <code>hello</code> function.</p>
<div class="highlight"><pre><span></span><code><span class="n">hello</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;wrapper&#39;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">help</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Help on function wrapper in module __main__:
    wrapper(*args, **kwargs)
</code></pre></div>

<p>Now what's going on there. The decorator <code>yell</code> has made the function <code>hello</code> confused
about its own identity. Instead of reporting its own name, it takes the identity of the
inner function <code>wrapper</code>. This can be confusing while doing debugging. You can fix this
by using builtin <code>wraps</code> decorator from the <code>functools</code> module. This will make sure
that the original identity of the decorated function stays preserved.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">yell</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@yell</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="s2">&quot;Hello from the other side.&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Galaxy&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;HELLO GALAXY!&#39;
</code></pre></div>

<p>Introspecting the <code>hello</code> function decorated with modified decorator will give you the
desired result.</p>
<div class="highlight"><pre><span></span><code><span class="n">hello</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;hello&#39;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">help</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Help on function hello in module __main__:

    hello(name)
        Hello from the other side.
</code></pre></div>

<h2>Decorators in the wild</h2>
<p>Before moving on to the next section let's see a few real world examples of decorators.
To define all the decorators, we'll be using the following template that we've
perfected so far.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Do something before</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Do something after</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>

<h3>Timer</h3>
<p>Timer decorator will help you time your callables in a non-intrusive way. It can help
you while debugging and profiling your functions.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">perf_counter</span>


<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This decorator prints out the execution time of a callable.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
        <span class="n">run_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished running </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">run_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">dothings</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">i</span><span class="o">**</span><span class="mi">3</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)))</span>
</code></pre></div>

<p>In the above way, we can introspect the time it requires for function <code>dothings</code> to
complete its execution.</p>
<div class="highlight"><pre><span></span><code><span class="n">dothings</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Finished running dothings in 0.0353 seconds.
    24999500002500000000
</code></pre></div>

<h3>Exception logger</h3>
<p>Just like the <code>timer</code> decorator, we can define a logger decorator that will log the
state of a callable. For this demonstration, I'll be defining a exception logger that
will show additional information like timestamp, argument names when an exception
occurs inside of the decorated callable.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="k">def</span> <span class="nf">logexc</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># Stringify the arguments</span>
        <span class="n">args_rep</span> <span class="o">=</span> <span class="p">[</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">kwargs_rep</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">!r}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args_rep</span> <span class="o">+</span> <span class="n">kwargs_rep</span><span class="p">)</span>

        <span class="c1"># Try running the function</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time: &quot;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> [%H:%M:%S]&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arguments: &quot;</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@logexc</span>
<span class="k">def</span> <span class="nf">divint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
</code></pre></div>

<p>Let's invoke ZeroDivisionError to see the logger in action.</p>
<div class="highlight"><pre><span></span><code><span class="n">divint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Time:  2020-05-12 [12:03:31]
    Arguments:  1, 0
    Error:

        ------------------------------------------------------------

        ZeroDivisionError         Traceback (most recent call last)
        ....
</code></pre></div>

<p>The decorator first prints a few info regarding the function and then raises the
original error.</p>
<h3>Validation &amp; runtime checks</h3>
<p>Python’s type system is strongly typed, but very dynamic. For all its benefits, this
means some bugs can try to creep in, which more statically typed languages (like Java)
would catch at compile time. Looking beyond even that, you may want to enforce more
sophisticated, custom checks on data going in or out. Decorators can let you easily
handle all of this, and apply it to many functions at once.</p>
<p>Imagine this: you have a set of functions, each returning a dictionary, which (among
other fields) includes a field called “summary.” The value of this summary must not be
more than 30 characters long; if violated, that’s an error. Here is a decorator that
raises a ValueError if that happens:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">validate_summary</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Summary exceeds 30 character limit.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@validate_summary</span>
<span class="k">def</span> <span class="nf">short_summary</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a short summary&quot;</span><span class="p">}</span>


<span class="nd">@validate_summary</span>
<span class="k">def</span> <span class="nf">long_summary</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="s2">&quot;This is a long summary that exceeds character limit.&quot;</span><span class="p">}</span>


<span class="nb">print</span><span class="p">(</span><span class="n">short_summary</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">long_summary</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;summary&#39;</span><span class="o">:</span><span class="w"> </span><span class="s">&#39;This is a short summary&#39;</span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="o">-------------------------------------------------------------------</span><span class="w"></span>

<span class="w">    </span><span class="n">ValueError</span><span class="w">                       </span><span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="kr">last</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="n">input</span><span class="o">-</span><span class="mi">178</span><span class="o">-</span><span class="mi">7375</span><span class="n">d8e2a623</span><span class="o">&gt;</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="o">&lt;</span><span class="kr">module</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">            </span><span class="mi">19</span><span class="w"></span>
<span class="w">            </span><span class="mi">20</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">short_summary</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="o">---&gt;</span><span class="w"> </span><span class="mi">21</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">long_summary</span><span class="p">())</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
</code></pre></div>

<h3>Retry</h3>
<p>Imagine a situation where your defined callable fails due to some I/O related issues
and you'd like to retry that again. Decorator can help you to achieve that in a
reusable manner. Let's define a <code>retry</code> decorator that will rerun the decorated
function multiple times if an http error occurs.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">retry</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This will rerun the decorated callable 3 times if</span>
<span class="sd">    the callable encounters http 500/404 error.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">n_tries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">500</span>
                <span class="ow">or</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span>
                <span class="ow">and</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="n">n_tries</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;retrying... (</span><span class="si">{</span><span class="n">tries</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">break</span>
        <span class="k">return</span> <span class="n">resp</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@retry</span>
<span class="k">def</span> <span class="nf">getdata</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>


<span class="n">resp</span> <span class="o">=</span> <span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/get/1&quot;</span><span class="p">)</span>
<span class="n">resp</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; retrying... (0)
    retrying... (1)
    retrying... (2)

    &#39;<span class="cp">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt;</span>\n<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>404 Not Found<span class="p">&lt;/</span>
    <span class="nt">title</span><span class="p">&gt;</span>\n<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Not Found<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>\n<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>The requested URL was not found on the server.  If
    you entered the URL manually please check your spelling and try again.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>\n&#39;
</code></pre></div>

<h2>Applying multiple decorators</h2>
<p>You can apply multiple decorators to a function by stacking them on top of each other.
Let's define two simple decorators and use them both on a function.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Greet in English.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">ret</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">flare</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add flares to the string.&quot;&quot;&quot;</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;🎉 &quot;</span> <span class="o">+</span> <span class="n">ret</span> <span class="o">+</span> <span class="s2">&quot; 🎉&quot;</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@flare</span>
<span class="nd">@greet</span>
<span class="k">def</span> <span class="nf">getname</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">name</span>


<span class="n">getname</span><span class="p">(</span><span class="s2">&quot;Nafi&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; &#39;🎉 Hello Nafi! 🎉&#39;
</code></pre></div>

<p>The decorators are called in a bottom up order. First, the decorator <code>greet</code> gets
applied on the result of <code>getname</code> function and then the result of <code>greet</code> gets passed
to the <code>flare</code> decorator. The decorator stack above can be written as
<code>flare(greet(getname(name)))</code>. Change the order of the decorators and see what happens!</p>
<h2>Decorators with arguments</h2>
<p>While defining the <code>retry</code> decorator in the previous section, you may have noticed that
I've hard coded the number of times I'd like the function to retry if an error occurs.
It'd be handy if you could inject the number of tries as a parameter into the decorator
and make it work accordingly. This is not a trivial task and you'll need three levels
of nested functions to achieve that.</p>
<p>Before doing that let's cook up a trivial example of how you can define decorators with
parameters.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">joinby</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This decorator splits the string output of the</span>
<span class="sd">    decorated function by a single space and then joins</span>
<span class="sd">    them using a user specified delimiter.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">outer_wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">inner_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">return</span> <span class="n">inner_wrapper</span>

    <span class="k">return</span> <span class="n">outer_wrapper</span>


<span class="nd">@joinby</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="nd">@joinby</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Greetings </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="nd">@joinby</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Goodbye </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Nafi&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">greet</span><span class="p">(</span><span class="s2">&quot;Redowan&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">goodbye</span><span class="p">(</span><span class="s2">&quot;Delowar&quot;</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Hello,Nafi!
    Greetings&gt;Redowan!
    Goodbye Delowar!
</code></pre></div>

<p>The decorator <code>joinby</code> takes a single parameter called <code>delimiter</code>. It splits the
string output of the decorated function by a single space and then joins them using the
user defined delimiter specified in the <code>delimiter</code> argument. The three layer nested
definition looks scary but we'll get to that in a moment. Notice how you can use the
decorator with different parameters. In the above example, I've defined three different
functions to demonstrate the usage of <code>joinby</code>. It's important to note that in case of
a decorator that takes parameters, you'll always need to pass something to it and even
if you don't want to pass any parameter (run with the default), you'll still need to
decorate your function with <code>deco()</code> instead of <code>deco</code>. Try changing the decorator on
the <code>goodbye</code> function from <code>joinby()</code> to <code>joinby</code> and see what happens.</p>
<p>Typically, a decorator creates and returns an inner wrapper function but here in the
<code>repeat</code> decorator, there is an inner function within another inner function. This
almost looks like a <em>dream within a dream</em> from the movie Inception.</p>
<p>There are a few subtle things happening in the <code>joinby()</code> function:</p>
<ul>
<li>
<p>Defining <code>outer_wrapper()</code> as an inner function means that <code>repeat()</code> will refer to a
function object <code>outer_wrapper</code>.</p>
</li>
<li>
<p>The <code>delimiter</code> argument is seemingly not used in <code>joinby()</code> itself. But by passing
<code>delimiter</code> a closure is created where the value of <code>delimiter</code> is stored until it will
be used later by <code>inner_wrapper()</code></p>
</li>
</ul>
<h2>Decorators with &amp; without arguments</h2>
<p>You saw earlier that a decorator specifically designed to take parameters can't be used
without parameters; you need to at least apply parenthesis after the decorator <code>deco()</code>
to use it without explicitly providing the arguments. But what if you want to design
one that can used both with and without arguments. Let's redefine the <code>joinby</code>
decorator so that you can use it with parameters or just like an ordinary
parameter-less decorator that we've seen before.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">joinby</span><span class="p">(</span><span class="n">_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This decorator splits the string output</span>
<span class="sd">    of a function by a single space and then joins that</span>
<span class="sd">    using a user specified delimiter.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">outer_wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">inner_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">return</span> <span class="n">inner_wrapper</span>

    <span class="c1"># This part enables you to use the decorator with/without arguments</span>
    <span class="k">if</span> <span class="n">_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">outer_wrapper</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">outer_wrapper</span><span class="p">(</span><span class="n">_func</span><span class="p">)</span>


<span class="nd">@joinby</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="nd">@joinby</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Greetings </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Nafi&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">greet</span><span class="p">(</span><span class="s2">&quot;Redowan&quot;</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Hello,Nafi!
    Greetings Redowan!
</code></pre></div>

<p>Here, the <code>_func</code> argument acts as a marker, noting whether the decorator has been
called with arguments or not:</p>
<p>If <code>joinby</code> has been called without arguments, the decorated function will be passed in
as <code>_func</code>. If it has been called with arguments, then <code>_func</code> will be None. The * in
the argument list means that the remaining arguments can’t be called as positional
arguments. This time you can use <code>joinby</code> with or without arguments and function
<code>hello</code> and <code>greet</code> above demonstrate that.</p>
<h2>A generic pattern</h2>
<p>Personally, I find it cumbersome how you need three layers of nested functions to
define a generalized decorator that can be used with or without arguments.
<a href="https://www.dabeaz.com/">David Beazly</a> in his book
<a href="https://realpython.com/asins/1449340377/">Python Cookbook</a> shows an excellent way to
define generalized decorators without writing three levels of nested functions. It uses
the built in <code>functools.partial</code> function to achieve that. The following is a pattern
you can use to define generalized decorators in a more elegant way:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span><span class="p">,</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="s2">&quot;spam&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">decorator</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">foo</span><span class="p">)</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Do something with `func` and `foo`, if you&#39;re so inclined</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="c1"># Applying decorator without any parameter</span>
<span class="nd">@decorator</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="c1"># Applying decorator with extra parameter</span>
<span class="nd">@decorator</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s2">&quot;buzz&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Let's redefine our <code>retry</code> decorator using this pattern.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span><span class="p">,</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">retry</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_tries</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">retry</span><span class="p">,</span> <span class="n">n_tries</span><span class="o">=</span><span class="n">n_tries</span><span class="p">)</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">500</span>
                <span class="ow">or</span> <span class="n">ret</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span>
                <span class="ow">and</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="n">n_tries</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;retrying... (</span><span class="si">{</span><span class="n">tries</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">break</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@retry</span>
<span class="k">def</span> <span class="nf">getdata</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>


<span class="nd">@retry</span><span class="p">(</span><span class="n">n_tries</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">getdata_</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>


<span class="n">resp1</span> <span class="o">=</span> <span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/get/1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------&quot;</span><span class="p">)</span>
<span class="n">resp2</span> <span class="o">=</span> <span class="n">getdata_</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/get/1&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; retrying... (0)
    retrying... (1)
    retrying... (2)
    retrying... (3)
    -----------------------
    retrying... (0)
    retrying... (1)
</code></pre></div>

<p>In this case, you do not have to write three level nested functions and the <code>functools.
partial</code> takes care of that. Partials can be used to make new derived functions that
have some input parameters pre-assigned.Roughly <code>partial</code> does the following:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">part_args</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">extra_args</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">part_args</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>

<p>This eliminates the need to write multiple layers of nested factory function get a
generalized decorator.</p>
<h2>Defining decorators with classes</h2>
<p>This time, I'll be using a class to compose a decorator. Classes can be handy to avoid
nested architecture while writing decorators. Also, it can be helpful to use a class
while writing stateful decorators. You can follow the pattern below to compose
decorators with classes.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">class</span> <span class="nc">ClassDeco</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="c1"># Does the work of the &#39;functools.wraps&#39; in methods.</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># You can add some code before the function call</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># You can also add some code after the function call</span>

        <span class="k">return</span> <span class="n">ret</span>
</code></pre></div>

<p>Let's use the above template to write a decorator named <code>Emphasis</code> that will add bold
tags <code>&lt;b&gt;&lt;/b&gt;</code>to the string output of a function.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">class</span> <span class="nc">Emphasis</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;b&gt;&quot;</span> <span class="o">+</span> <span class="n">ret</span> <span class="o">+</span> <span class="s2">&quot;&lt;/b&gt;&quot;</span>


<span class="nd">@Emphasis</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Nafi&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Redowan&quot;</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; <span class="nt">&lt;b&gt;</span>Hello Nafi<span class="nt">&lt;/b&gt;</span>
    <span class="nt">&lt;b&gt;</span>Hello Redowan<span class="nt">&lt;/b&gt;</span>
</code></pre></div>

<p>The <strong>init</strong>() method stores a reference to the function num_calls and can do other
necessary initialization. The <strong>call</strong>() method will be called instead of the decorated
function. It does essentially the same thing as the <code>wrapper()</code> function in our earlier
examples. Note that you need to use the <code>functools.update_wrapper()</code> function instead
of <code>@functools.wraps</code>.</p>
<p>Before moving on, let's write a stateful decorator using classes. Stateful decorators
can remember the state of their previous run. Here's a stateful decorator called
<code>Tally</code> that will keep track of the number of times decorated functions are called in a
dictionary. The keys of the dictionary will hold the names of the functions and the
corresponding values will hold the call count.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">functools</span>


<span class="k">class</span> <span class="nc">Tally</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tally</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_calls</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_calls</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tally</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_calls</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Callable Tally:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tally</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="nd">@Tally</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>


<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Redowan&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="s2">&quot;Nafi&quot;</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Callable Tally: {&#39;hello&#39;: 1}
    Hello Redowan!
    Callable Tally: {&#39;hello&#39;: 2}
    Hello Nafi!
</code></pre></div>

<h2>A few more examples</h2>
<h3>Caching return values</h3>
<p>Decorators can provide an elegant way of memoizing function return values. Imagine you
have an expensive API and you'd like call that as few times as possible. The idea is to
save and cache values returned by the API for particular arguments, so that if those
arguments appear again, you can serve the results from the cache instead of calling the
API again. This can dramatically improve your applications' performance. Here I've
simulated an expensive API call and provided caching with a decorator.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">api</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;API takes an integer and returns the square value of it.</span>
<span class="sd">    To simulate a time consuming process, I&#39;ve added some time delay to it.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The API has been called...&quot;</span><span class="p">)</span>

    <span class="c1"># This will delay 3 seconds</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span>


<span class="n">api</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; The API has been called...
    9
</code></pre></div>

<p>You'll see that running this function takes roughly 3 seconds. To cache the result, we
can use Python's built in functools.lru_cache to save the result against an argument in
a dictionary and serve that when it encounters the same argument again. The only
drawback here is, all the arguments need to be hashable.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">functools</span>


<span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">api</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;API takes an integer and returns the square value of it.</span>
<span class="sd">    To simulate a time consuming process, I&#39;ve added some time delay to it.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The API has been called...&quot;</span><span class="p">)</span>

    <span class="c1"># This will delay 3 seconds</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span>


<span class="n">api</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; 9
</code></pre></div>

<p>Least Recently Used (LRU) Cache organizes items in order of use, allowing you to
quickly identify which item hasn't been used for the longest amount of time. In the
above case, the parameter <code>max_size</code> refers to the maximum numbers of responses to be
saved up before it starts deleting the earliest ones. While you run the decorated
function, you'll see first time it'll take roughly 3 seconds to return the result. But
if you rerun the function again with the same parameter it'll spit the result from the
cache almost instantly.</p>
<h3>Unit Conversion</h3>
<p>The following decorator converts length from SI units to multiple other units without
polluting your target function with conversion logics.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">convert_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This converts value from meter to others.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">convert</span><span class="p">,</span> <span class="n">convert_to</span><span class="o">=</span><span class="n">convert_to</span><span class="p">)</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversion unit: </span><span class="si">{</span><span class="n">convert_to</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Adding conversion rules</span>
        <span class="k">if</span> <span class="n">convert_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">elif</span> <span class="n">convert_to</span> <span class="o">==</span> <span class="s2">&quot;km&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="k">elif</span> <span class="n">convert_to</span> <span class="o">==</span> <span class="s2">&quot;mile&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span> <span class="o">*</span> <span class="mf">0.000621371</span>

        <span class="k">elif</span> <span class="n">convert_to</span> <span class="o">==</span> <span class="s2">&quot;cm&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="k">elif</span> <span class="n">convert_to</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span> <span class="o">*</span> <span class="mi">1000</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Conversion unit is not supported.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>

<p>Let's use that on a function that returns the area of a rectangle.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@convert</span><span class="p">(</span><span class="n">convert_to</span><span class="o">=</span><span class="s2">&quot;mile&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>


<span class="n">area</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; Conversion unit: mile
    0.001242742
</code></pre></div>

<p>Using the convert decorator on the area function shows how it prints out the
transformation unit before returning the desired result. Experiment with other
conversion units and see what happens.</p>
<h3>Function registration</h3>
<p>The following is an example of registering logger function in Flask framework. The
decorator <code>register_logger</code> doesn't make any change to the decorated <code>logger</code> function.
Rather it takes the function and registers it in a list called <code>logger_list</code> every time
it's invoked.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger_list</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">register_logger</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">logger_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">run_loggers</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">logger</span> <span class="ow">in</span> <span class="n">logger_list</span><span class="p">:</span>
        <span class="n">logger</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>


<span class="nd">@register_logger</span>
<span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">run_loggers</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Hello World!&quot;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s2">&quot;5000&quot;</span><span class="p">)</span>
</code></pre></div>

<p>If you run the server and hit the <code>http://localhost:5000/</code> url, it'll greet you with a
<code>Hello World!</code> message. Also you'll able to see the printed <code>method</code> and <code>path</code> of your
http request on the terminal. Moreover, if you inspect the <code>logger_list</code>, you'll find
the registered logger there. You'll find a lot more real life usage of decorators in
the Flask framework.</p>
<h2>References</h2>
<ul>
<li><a href="https://realpython.com/primer-on-python-decorators/">Primer on Python decorator - Real Python</a></li>
<li><a href="https://www.datacamp.com/community/tutorials/decorators-python">Decorators in Python - DataCamp</a></li>
<li><a href="https://www.oreilly.com/content/5-reasons-you-need-to-learn-to-write-python-decorators/">5 reasons you need to write Python decorators</a></li>
</ul>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-05-13T00:00:00+06:00">Wed 13 May 2020</time>
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#python-ref">Python
                    <span class="superscript">58</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="mailto:redowan.nafi@gmail.com" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#328cff"/><path d="m250 186c-46 0-69 35-69 74 0 44 29 72 68 72 43 0 73-32 73-75 0-44-34-71-72-71zm-1-37c30 0 57 13 77 33 0-22 35-22 35 1v150c-1 10 10 16 16 9 25-25 54-128-14-187-64-56-149-47-195-15-48 33-79 107-49 175 33 76 126 99 182 76 28-12 41 26 12 39-45 19-168 17-225-82-38-68-36-185 67-248 78-46 182-33 244 32 66 69 62 197-2 246-28 23-71 1-71-32v-11c-20 20-47 32-77 32-57 0-108-51-108-108 0-58 51-110 108-110" fill="#fff"/></svg>
    </a>
    <a href="https://github.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://twitter.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://www.goodreads.com/user/show/53485837-redowan-delowar" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><rect fill="#EAE6CF" height="512" rx="64" width="512"/><path d="m254.92444 336.92444c43.2889-.36 74.07112-22.01333 92.33334-64.95111h.95556v65.48889c0 4.88-.32 12.44889-.95556 22.73333-1.30222 10.64445-4.78222 22.10223-10.42666 34.36889-5.65778 11.54667-14.79112 21.38667-27.37778 29.49778-12.44889 8.84-29.81778 13.44-52.12001 13.80444-21.48444 0-39.65333-5.59555-54.52444-16.77777-15.2-11.00889-24.08001-28.87111-26.65778-53.58667h-18.89778c1.93778 32.11111 12.18667 55.02667 30.76444 68.74222 18.08889 13.16445 41.04001 19.75556 68.83556 19.75556 27.45778 0 48.87112-5.14223 64.21778-15.43111 15.18223-9.92 26.08445-22.28445 32.71556-37.08 6.62222-14.79111 10.58222-28.86667 11.86667-42.21334.98222-13.35555 1.45778-22.91555 1.45778-28.68889v-270.088875h-18.90667v59.537775h-.95556c-7.27555-21.82667-19.30666-38.333335-36.12-49.524445-16.96-11.00445-35.70222-16.51111-56.21333-16.51111-35.72001.72444-62.85779 14.52444-81.43112 41.40889-19.07111 26.697775-28.59556 59.631105-28.59556 98.782195 0 40.23557 9.04445 73.52001 27.13334 99.86224 18.27555 26.88889 45.89778 40.51111 82.90222 40.87111zm-68.34222-224.89777c14.85333-24.359995 37.63111-36.986665 68.34222-37.888885 31.50223.90666 54.83556 13.17333 70.03556 36.808885 15.18223 23.64 22.77778 52.05331 22.77778 85.25331s-7.59555 61.43112-22.77778 84.70668c-15.2 24.72444-38.53333 37.34667-70.03556 37.88889-29.72889-.54667-52.36-12.81778-67.86222-36.80889-15.67556-23.27556-23.50667-51.87112-23.50667-85.79112-.004-31.75556 7.67111-59.81332 23.02667-84.16887z" fill="#743901"/></svg>
    </a>
    <a href="/reflections/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>



    <div id="fpowered">

            © 2020-2022 • Redowan Delowar • All Rights Reserved


    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>