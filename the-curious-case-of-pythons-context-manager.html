<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="google-site-verification" content="<meta name='google-site-verification' content='N5QEPRj-LpgoEY0Hf3uVMmZq8kjDwTFjd54IgvLmRBc' />" />        <meta name="author" content="Redowan Delowar" />

        <meta name="description" content="Python&#39;s context managers are great for resource management and stopping the propagation of leaked abstractions. You&#39;ve probably used it while opening a file or a database connection. Usually it starts with a with statement like this: with open(&#34;file.txt&#34;, &#34;wt&#34;) as f: f.write(&#34;contents go here&#34;) In the …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, python, " />

<meta property="og:title" content="The curious case of Python&#39;s context manager "/>
<meta property="og:url" content="./the-curious-case-of-pythons-context-manager.html" />
<meta property="og:description" content="Python&#39;s context managers are great for resource management and stopping the propagation of leaked abstractions. You&#39;ve probably used it while opening a file or a database connection. Usually it starts with a with statement like this: with open(&#34;file.txt&#34;, &#34;wt&#34;) as f: f.write(&#34;contents go here&#34;) In the …" />
<meta property="og:site_name" content="Redowan&#39;s Reflections" />
<meta property="og:article:author" content="Redowan Delowar" />
<meta property="og:article:published_time" content="2020-03-26T00:00:00+06:00" />
<meta name="twitter:title" content="The curious case of Python&#39;s context manager ">
<meta name="twitter:description" content="Python&#39;s context managers are great for resource management and stopping the propagation of leaked abstractions. You&#39;ve probably used it while opening a file or a database connection. Usually it starts with a with statement like this: with open(&#34;file.txt&#34;, &#34;wt&#34;) as f: f.write(&#34;contents go here&#34;) In the …">
<meta property="og:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" />
<meta name="twitter:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" >

        <title>The curious case of Python&#39;s context manager  · Redowan&#39;s Reflections
</title>
        <link href="https://rednafi.github.io/reflections/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Redowan&#39;s Reflections - Full Atom Feed" />

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-217287505-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>Redowan's Reflections</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./pages/contact.html">Contact</a></li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li>
                                  <form action="https://www.google.com/search" class="navbar-search" method="get" name="searchform" target="_blank">
                                    <input name="sitesearch" type="hidden"
                                    value="rednafi.github.io/reflections">
                                    <input autocomplete="on" class="search-query" name="q" placeholder="Search"
                                    required="required"  type="text">
                                    <input type="submit" value="Search" style="visibility: hidden;" /></form>
                                  </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./the-curious-case-of-pythons-context-manager.html">
                The curious case of Python's context manager
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Python's context managers are great for resource management and stopping the propagation
of leaked abstractions. You've probably used it while opening a file or a database
connection. Usually it starts with a <code>with</code> statement like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;contents go here&quot;</span><span class="p">)</span>
</code></pre></div>

<p>In the above case, <code>file.txt</code> gets automatically closed when the execution flow goes out
of the scope. This is equivalent to writing:</p>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;contents go here&quot;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<h2>Writing custom context managers</h2>
<p>To write a custom context manager, you need to create a class that includes the
<code>__enter__</code> and <code>__exit__</code> methods. Let's recreate a custom context manager that will
execute the same workflow as above.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CustomFileOpen</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Custom context manager for opening files.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>You can use the above class just like a regular context manager.</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">CustomFileOpen</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;contents go here&quot;</span><span class="p">)</span>
</code></pre></div>

<h2>From generators to context managers</h2>
<p>Creating context managers by writing a class with <code>__enter__</code> and <code>__exit__</code> methods, is
not difficult. However, you can achieve better brevity by defining them using
<code>contextlib.contextmanager</code> decorator. This decorator converts a generator function into
a context manager. The blueprint for creating context manager decorators goes something
like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">some_generator</span><span class="p">(</span><span class="o">&lt;</span><span class="n">arguments</span><span class="o">&gt;</span><span class="p">):</span>
    <span class="o">&lt;</span><span class="n">setup</span><span class="o">&gt;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="o">&lt;</span><span class="n">cleanup</span><span class="o">&gt;</span>
</code></pre></div>

<p>When you use the context manager with the <code>with</code> statement:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">some_generator</span><span class="p">(</span><span class="o">&lt;</span><span class="n">arguments</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">variable</span><span class="o">&gt;</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</code></pre></div>

<p>It roughly translates to:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">setup</span><span class="o">&gt;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">variable</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="o">&lt;</span><span class="n">cleanup</span><span class="o">&gt;</span>
</code></pre></div>

<p>The setup code goes before the <code>try..finally</code> block. Notice the point where the
generator yields. This is where the code block nested in the <code>with</code> statement gets
executed. After the completion of the code block, the generator is then resumed. If an
unhandled exception occurs in the block, it's re-raised inside the generator at the
point where the <code>yield</code> occurred and then the <code>finally</code> block is executed. If no
unhandled exception occurs, the code gracefully proceeds to the <code>finally</code> block where
you run your cleanup code.</p>
<p>Let's implement the same <code>CustomFileOpen</code> context manager with <code>contextmanager</code>
decorator.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">CustomFileOpen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom context manager for opening a file.&quot;&quot;&quot;</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">f</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>Now use it just like before:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">CustomFileOpen</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;contents go here&quot;</span><span class="p">)</span>
</code></pre></div>

<h2>Writing context managers as decorators</h2>
<p>You can use context managers as decorators also. To do so, while defining the class, you
have to inherit from <code>contextlib.ContextDecorator</code> class. Let's make a <code>RunTime</code>
decorator that will be applied on a file-opening function. The decorator will:</p>
<ul>
<li>Print a user provided description of the function</li>
<li>Print the time it takes to run the function</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">ContextDecorator</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>


<span class="k">class</span> <span class="nc">RunTime</span><span class="p">(</span><span class="n">ContextDecorator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Timing decorator.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">run_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The function took </span><span class="si">{</span><span class="n">run_time</span><span class="si">}</span><span class="s2"> seconds to run.&quot;</span><span class="p">)</span>
</code></pre></div>

<p>You can use the decorator like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@RunTime</span><span class="p">(</span><span class="s2">&quot;This function opens a file&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">custom_file_write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>

<p>Using the function like this should return:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">custom_file_write</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">,</span> <span class="s2">&quot;jello&quot;</span><span class="p">))</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>This function opens a file
The function took 0.0005390644073486328 seconds to run.
None
</code></pre></div>

<p>You can also create the same decorator via <code>contextlib.contextmanager</code> decorator.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">runtime</span><span class="p">(</span><span class="n">description</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">run_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The function took </span><span class="si">{</span><span class="n">run_time</span><span class="si">}</span><span class="s2"> seconds to run.&quot;</span><span class="p">)</span>
</code></pre></div>

<h2>Nesting contexts</h2>
<p>You can nest multiple context managers to manage resources simultaneously. Consider the
following dummy manager:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entering:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exiting :&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="c1"># multiple get_state can be nested like this</span>
<span class="k">with</span> <span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">A</span><span class="p">,</span> <span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">B</span><span class="p">,</span> <span class="n">get_state</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">C</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;inside with statement:&quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">entering</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"></span>
<span class="n">entering</span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="w"></span>
<span class="n">entering</span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="w"></span>
<span class="n">inside</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">statement</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">C</span><span class="w"></span>
<span class="n">exiting</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="w"></span>
<span class="n">exiting</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">B</span><span class="w"></span>
<span class="n">exiting</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"></span>
</code></pre></div>

<p>Notice the order they're closed. Context managers are treated as a stack, and should be
exited in reverse order in which they're entered. If an exception occurs, this order
matters, as any context manager could suppress the exception, at which point the
remaining managers will not even get notified of this. The <code>__exit__</code> method is also
permitted to raise a different exception, and other context managers then should be able
to handle that new exception.</p>
<h2>Combining multiple context managers</h2>
<p>You can combine multiple context managers too. Let's consider these two managers.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entering a:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exiting a:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entering b:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">name</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;exiting b:&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>

<p>Now combine these two using the decorator syntax. The following function takes the above
define managers <code>a</code> and <code>b</code> and returns a combined context manager <code>ab</code>.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">ab</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">a</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">B</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
</code></pre></div>

<p>This can be used as:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">ab</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">as</span> <span class="n">AB</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inside the composite context manager:&quot;</span><span class="p">,</span> <span class="n">AB</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>entering a: A
entering b: B
Inside the composite context manager: (&#39;A&#39;, &#39;B&#39;)
exiting b: B
exiting a: A
</code></pre></div>

<p>If you have variable numbers of context managers and you want to combine them
gracefully, <code>contextlib.ExitStack</code> is here to help. Let's rewrite context manager <code>ab</code>
using <code>ExitStack</code>. This function takes the individual context managers and their
arguments as tuples and returns the combined manager.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span><span class="p">,</span> <span class="n">ExitStack</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">ab</span><span class="p">(</span><span class="n">cms</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">cm</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span> <span class="k">for</span> <span class="n">cm</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cms</span><span class="p">,</span> <span class="n">args</span><span class="p">)]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">ab</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">AB</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inside the composite context manager:&quot;</span><span class="p">,</span> <span class="n">AB</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>entering a: A
entering b: B
Inside the composite context manager: [&#39;A&#39;, &#39;B&#39;]
exiting b: B
exiting a: A
</code></pre></div>

<p><code>ExitStack</code> can be also used in cases where you want to manage multiple resources
gracefully. For example, suppose, you need to create a list from the contents of
multiple files in a directory. Let's see, how you can do so while avoiding accidental
memory leakage with robust resource management.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">ExitStack</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># ExitStack ensures all files are properly closed after o/p</span>
<span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
    <span class="n">streams</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">]</span>
</code></pre></div>

<h2>Using context managers to create SQLAlchemy session</h2>
<p>If you are familiar with SQLALchemy, Python's SQL toolkit and Object Relational Mapper,
then you probably know the usage of <code>Session</code> to run a query. A <code>Session</code> basically
turns any query into a transaction and make it atomic. Context managers can help you
write a transaction session in a very elegant way. A basic querying workflow in
SQLAlchemy may look like this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="c1"># an Engine, which the Session will use for connection resources</span>
<span class="n">some_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>

<span class="c1"># create a configured &quot;Session&quot; class</span>
<span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">some_engine</span><span class="p">)</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">session_scope</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Provide a transactional scope around a series of operations.&quot;&quot;&quot;</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>The excerpt above creates an in memory <code>SQLite</code> connection and a <code>session_scope</code>
function with context manager. The session_scope function takes care of committing and
rolling back in case of exception automatically. The <code>session_scope</code> function can be
used to run queries in the following way:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">myobject</span> <span class="o">=</span> <span class="n">MyObject</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">myobject</span><span class="p">)</span>
</code></pre></div>

<h2>Abstract away exception handling monstrosity with context managers</h2>
<p>This is my absolute favorite use case of context managers. Suppose you want to write a
function but want the exception handling logic out of the way. Exception handling logics
with sophisticated logging can often obfuscate the core logic of your function. You can
write a decorator type context manager that will handle the exceptions for you and
decouple these additional code from your main logic. Let's write a decorator that will
handle <code>ZeroDivisionError</code> and <code>TypeError</code> simultaneously.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">errhandler</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a custom ZeroDivisionError message.&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is a custom TypeError message.&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>

<p>Now use this in a function where these exceptions occur.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@errhandler</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">//</span> <span class="n">b</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">div</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">TypeError</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="w"></span>
<span class="o">---------------------------------------------------------------------------</span><span class="w"></span>

<span class="n">TypeError</span><span class="w">                                 </span><span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="k">last</span><span class="p">)</span><span class="w"></span>

<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="k">input</span><span class="o">-</span><span class="mi">43</span><span class="o">-</span><span class="mi">65497</span><span class="n">ed57253</span><span class="o">&gt;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">&lt;</span><span class="k">module</span><span class="o">&gt;</span><span class="w"></span>
<span class="o">----&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">contextlib</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="mi">73</span><span class="w">         </span><span class="n">def</span><span class="w"> </span><span class="k">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span><span class="err">:</span><span class="w"></span>
<span class="w">        </span><span class="mi">74</span><span class="w">             </span><span class="k">with</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_recreate_cm</span><span class="p">()</span><span class="err">:</span><span class="w"></span>
<span class="o">---&gt;</span><span class="w"> </span><span class="mi">75</span><span class="w">                 </span><span class="k">return</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwds</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="mi">76</span><span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="k">inner</span><span class="w"></span>
<span class="w">        </span><span class="mi">77</span><span class="w"></span>


<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="k">input</span><span class="o">-</span><span class="mi">42</span><span class="o">-</span><span class="n">b7041bcaa9e6</span><span class="o">&gt;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="nv">@errhandler</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="mi">2</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="err">:</span><span class="w"></span>
<span class="o">----&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">b</span><span class="w"></span>


<span class="nl">TypeError</span><span class="p">:</span><span class="w"> </span><span class="n">unsupported</span><span class="w"> </span><span class="n">operand</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">//</span><span class="err">:</span><span class="w"> </span><span class="s1">&#39;str&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s1">&#39;int&#39;</span><span class="w"></span>
</code></pre></div>

<p>You can see that the <code>errhandler</code> decorator is doing the heavylifting for you. Pretty
neat, huh?</p>
<p>The following one is a more sophisticated example of using context manager to decouple
your error handling monstrosity from the main logic. It also hides the elaborate logging
logics from the main method.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(asctime)s [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s2">&quot;./debug.log&quot;</span><span class="p">),</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()],</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Calculation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Dummy class for demonstrating exception decoupling with contextmanager.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">errorhandler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Custom handling of Zero Division Error! Printing &quot;</span>
                <span class="s2">&quot;only 2 levels of traceback..&quot;</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;ZeroDivisionError&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">main_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function that we want to save from nasty error handling logic.&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>


<span class="n">obj</span> <span class="o">=</span> <span class="n">Calculation</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">main_func</span><span class="p">())</span>
</code></pre></div>

<p>This will return</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">asctime</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">[</span><span class="n">ERROR</span><span class="o">]</span><span class="w"> </span><span class="n">ZeroDivisionError</span><span class="w"></span>
<span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="k">last</span><span class="p">)</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="k">File</span><span class="w"> </span><span class="ss">&quot;&lt;ipython-input-44-ff609edb5d6e&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">errorhandler</span><span class="w"></span>
<span class="w">    </span><span class="n">yield</span><span class="w"></span>
<span class="w">    </span><span class="k">File</span><span class="w"> </span><span class="ss">&quot;&lt;ipython-input-44-ff609edb5d6e&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">main_func</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">b</span><span class="w"></span>
<span class="nl">ZeroDivisionError</span><span class="p">:</span><span class="w"> </span><span class="n">division</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">zero</span><span class="w"></span>


<span class="n">Custom</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Zero</span><span class="w"> </span><span class="n">Division</span><span class="w"> </span><span class="n">Error</span><span class="err">!</span><span class="w"> </span><span class="n">Printing</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">traceback</span><span class="p">..</span><span class="w"></span>
<span class="k">None</span><span class="w"></span>
</code></pre></div>

<h2>Persistent parameters across HTTP requests with context managers</h2>
<p>Another great use case for context managers is making parameters persistent across
multiple http requests. Python's <code>requests</code> library has a <code>Session</code> object that will let
you easily achieve this. So, if you’re making several requests to the same host, the
underlying TCP connection will be reused, which can result in a significant performance
increase. The following example is taken directly from
<a href="https://2.python-requests.org/en/v2.8.1/user/advanced/">requests'</a> official docs. Let's
persist some cookies across requests.</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/cookies/set/sessioncookie/123456789&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/cookies&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>

<p>This should show:</p>
<div class="highlight"><pre><span></span><code>{
  &quot;cookies&quot;: {
    &quot;sessioncookie&quot;: &quot;123456789&quot;
  }
}
</code></pre></div>

<h2>Remarks</h2>
<p>To avoid redundencies, I have purposefully excluded examples of nested with statements
and now deprecated <code>contextlib.nested</code> function to create nested context managers.</p>
<h2>Resources</h2>
<ul>
<li><a href="https://docs.python.org/3/library/contextlib.html">Python contextlib documentation</a></li>
<li><a href="https://jeffknupp.com/blog/2016/03/07/python-with-context-managers/">Python with context manager - Jeff Knupp</a></li>
<li><a href="https://docs.sqlalchemy.org/en/13/core/engines.html">SQLALchemy session creation</a></li>
<li><a href="https://scipy-lectures.org/advanced/advanced_python/index.html#context-managers">Scipy lectures: context managers</a></li>
<li><a href="https://stackoverflow.com/a/45681273/8963300">Merging context managers</a></li>
</ul>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-03-26T00:00:00+06:00">Thu 26 March 2020</time>
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#python-ref">Python
                    <span class="superscript">58</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="mailto:redowan.nafi@gmail.com" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#328cff"/><path d="m250 186c-46 0-69 35-69 74 0 44 29 72 68 72 43 0 73-32 73-75 0-44-34-71-72-71zm-1-37c30 0 57 13 77 33 0-22 35-22 35 1v150c-1 10 10 16 16 9 25-25 54-128-14-187-64-56-149-47-195-15-48 33-79 107-49 175 33 76 126 99 182 76 28-12 41 26 12 39-45 19-168 17-225-82-38-68-36-185 67-248 78-46 182-33 244 32 66 69 62 197-2 246-28 23-71 1-71-32v-11c-20 20-47 32-77 32-57 0-108-51-108-108 0-58 51-110 108-110" fill="#fff"/></svg>
    </a>
    <a href="https://github.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://twitter.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://www.goodreads.com/user/show/53485837-redowan-delowar" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><rect fill="#EAE6CF" height="512" rx="64" width="512"/><path d="m254.92444 336.92444c43.2889-.36 74.07112-22.01333 92.33334-64.95111h.95556v65.48889c0 4.88-.32 12.44889-.95556 22.73333-1.30222 10.64445-4.78222 22.10223-10.42666 34.36889-5.65778 11.54667-14.79112 21.38667-27.37778 29.49778-12.44889 8.84-29.81778 13.44-52.12001 13.80444-21.48444 0-39.65333-5.59555-54.52444-16.77777-15.2-11.00889-24.08001-28.87111-26.65778-53.58667h-18.89778c1.93778 32.11111 12.18667 55.02667 30.76444 68.74222 18.08889 13.16445 41.04001 19.75556 68.83556 19.75556 27.45778 0 48.87112-5.14223 64.21778-15.43111 15.18223-9.92 26.08445-22.28445 32.71556-37.08 6.62222-14.79111 10.58222-28.86667 11.86667-42.21334.98222-13.35555 1.45778-22.91555 1.45778-28.68889v-270.088875h-18.90667v59.537775h-.95556c-7.27555-21.82667-19.30666-38.333335-36.12-49.524445-16.96-11.00445-35.70222-16.51111-56.21333-16.51111-35.72001.72444-62.85779 14.52444-81.43112 41.40889-19.07111 26.697775-28.59556 59.631105-28.59556 98.782195 0 40.23557 9.04445 73.52001 27.13334 99.86224 18.27555 26.88889 45.89778 40.51111 82.90222 40.87111zm-68.34222-224.89777c14.85333-24.359995 37.63111-36.986665 68.34222-37.888885 31.50223.90666 54.83556 13.17333 70.03556 36.808885 15.18223 23.64 22.77778 52.05331 22.77778 85.25331s-7.59555 61.43112-22.77778 84.70668c-15.2 24.72444-38.53333 37.34667-70.03556 37.88889-29.72889-.54667-52.36-12.81778-67.86222-36.80889-15.67556-23.27556-23.50667-51.87112-23.50667-85.79112-.004-31.75556 7.67111-59.81332 23.02667-84.16887z" fill="#743901"/></svg>
    </a>
    <a href="/reflections/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>



    <div id="fpowered">

            © 2020-2022 • Redowan Delowar • All Rights Reserved


    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>