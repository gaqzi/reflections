<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="google-site-verification" content="<meta name='google-site-verification' content='N5QEPRj-LpgoEY0Hf3uVMmZq8kjDwTFjd54IgvLmRBc' />" />        <meta name="author" content="Redowan Delowar" />

        <meta name="description" content="Updated on 2020-07-13: Removed duplicate keys in docker-compose.yml Recently, I was working with MapBox&#39;s Route Optimization API. Basically, it tries to solve the traveling salesman problem where you provide the API with coordinates of multiple places and it returns a duration-optimized route between those locations. This is a …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, API, python, " />

<meta property="og:title" content="Effortless API request caching with Python &amp; Redis "/>
<meta property="og:url" content="./effortless-api-request-caching-with-python-redis.html" />
<meta property="og:description" content="Updated on 2020-07-13: Removed duplicate keys in docker-compose.yml Recently, I was working with MapBox&#39;s Route Optimization API. Basically, it tries to solve the traveling salesman problem where you provide the API with coordinates of multiple places and it returns a duration-optimized route between those locations. This is a …" />
<meta property="og:site_name" content="Redowan&#39;s Reflections" />
<meta property="og:article:author" content="Redowan Delowar" />
<meta property="og:article:published_time" content="2020-05-25T00:00:00+06:00" />
<meta name="twitter:title" content="Effortless API request caching with Python &amp; Redis ">
<meta name="twitter:description" content="Updated on 2020-07-13: Removed duplicate keys in docker-compose.yml Recently, I was working with MapBox&#39;s Route Optimization API. Basically, it tries to solve the traveling salesman problem where you provide the API with coordinates of multiple places and it returns a duration-optimized route between those locations. This is a …">
<meta property="og:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" />
<meta name="twitter:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" >

        <title>Effortless API request caching with Python &amp; Redis  · Redowan&#39;s Reflections
</title>
        <link href="https://rednafi.github.io/reflections/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Redowan&#39;s Reflections - Full Atom Feed" />

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-217287505-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>Redowan's Reflections</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./pages/contact.html">Contact</a></li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li>
                                  <form action="https://www.google.com/search" class="navbar-search" method="get" name="searchform" target="_blank">
                                    <input name="sitesearch" type="hidden"
                                    value="rednafi.github.io/reflections">
                                    <input autocomplete="on" class="search-query" name="q" placeholder="Search"
                                    required="required"  type="text">
                                    <input type="submit" value="Search" style="visibility: hidden;" /></form>
                                  </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./effortless-api-request-caching-with-python-redis.html">
                Effortless API request caching with Python & Redis
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p><strong><em>Updated on 2020-07-13</em></strong>: <em>Removed duplicate keys in docker-compose.yml</em></p>
<p>Recently, I was working with <a href="https://www.mapbox.com/">MapBox</a>'s
<a href="https://docs.mapbox.com/api/navigation/#optimization">Route Optimization API</a>.
Basically, it tries to solve the
<a href="https://en.wikipedia.org/wiki/Travelling_salesman_problem">traveling salesman problem</a>
where you provide the API with coordinates of multiple places and it returns a
duration-optimized route between those locations. This is a perfect usecase where
<a href="https://redis.io/">Redis</a> caching can come handy. Redis is a blazingly fast,
lightweight in-memory database with additional persistence options; making it a perfect
candidate for the task at hand. Here, caching can save you from making redundant API
requests and also, it can dramatically improve the response time as well.</p>
<p>I found that in my country, the optimized routes returned by the API do not change
dramatically for at least for a couple of hours. So the workflow will look something
like this:</p>
<ul>
<li>Caching the API response in Redis using the key-value data structure. Here the
requested coordinate-string will be the key and the response will be the corresponding
value</li>
<li>Setting a timeout on the records</li>
<li>Serving new requests from cache if the records exist</li>
<li>Only send a new request to MapBox API if the response is not cached and then add that
response to cache</li>
</ul>
<h2>Setting up Redis &amp; RedisInsight</h2>
<p>To proceed with the above workflow, you'll need to install and setup Redis database on
your system. For monitoring the database, I'll be using
<a href="https://redislabs.com/redisinsight/">RedisInsight</a>. The easiest way to setup Redis and
RedisInsight is through <a href="https://www.docker.com/">docker</a> and
<a href="https://docs.docker.com/compose/">docker-compose</a>. Here's a docker-compose that you can
use to setup everything with a single command.</p>
<div class="highlight"><pre><span></span><code># <span class="nv">docker</span><span class="o">-</span><span class="nv">compose</span>.<span class="nv">yml</span>

<span class="nv">version</span>: <span class="s2">&quot;</span><span class="s">3.9</span><span class="s2">&quot;</span>
<span class="nv">services</span>:
  <span class="nv">redis</span>:
    <span class="nv">container_name</span>: <span class="nv">redis</span><span class="o">-</span><span class="nv">cont</span>
    <span class="nv">image</span>: <span class="s2">&quot;</span><span class="s">redis:alpine</span><span class="s2">&quot;</span>
    <span class="nv">environment</span>:
      <span class="o">-</span> <span class="nv">REDIS_PASSWORD</span><span class="o">=</span><span class="nv">ubuntu</span>
      <span class="o">-</span> <span class="nv">REDIS_REPLICATION_MODE</span><span class="o">=</span><span class="nv">master</span>
    <span class="nv">ports</span>:
      <span class="o">-</span> <span class="s2">&quot;</span><span class="s">6379:6379</span><span class="s2">&quot;</span>
    <span class="nv">volumes</span>:
      # <span class="nv">save</span> <span class="nv">redisearch</span> <span class="nv">data</span> <span class="nv">to</span> <span class="nv">your</span> <span class="nv">current</span> <span class="nv">working</span> <span class="nv">directory</span>
      <span class="o">-</span> .<span class="o">/</span><span class="nv">redis</span><span class="o">-</span><span class="nv">data</span>:<span class="o">/</span><span class="nv">data</span>
    <span class="nv">command</span>:
      # <span class="nv">Save</span> <span class="k">if</span> <span class="mi">100</span> <span class="nv">keys</span> <span class="nv">are</span> <span class="nv">added</span> <span class="nv">in</span> <span class="nv">every</span> <span class="mi">10</span> <span class="nv">seconds</span>
      <span class="o">-</span> <span class="s2">&quot;</span><span class="s">--save 10 100</span><span class="s2">&quot;</span>
      # <span class="nv">Set</span> <span class="nv">password</span>
      <span class="o">-</span> <span class="s2">&quot;</span><span class="s">--requirepass ubuntu</span><span class="s2">&quot;</span>

  <span class="nv">redisinsight</span>: # <span class="nv">redis</span> <span class="nv">db</span> <span class="nv">visualization</span> <span class="nv">dashboard</span>
    <span class="nv">container_name</span>: <span class="nv">redisinsight</span><span class="o">-</span><span class="nv">cont</span>
    <span class="nv">image</span>: <span class="nv">redislabs</span><span class="o">/</span><span class="nv">redisinsight</span>
    <span class="nv">ports</span>:
      <span class="o">-</span> <span class="mi">8001</span>:<span class="mi">8001</span>
    <span class="nv">volumes</span>:
      <span class="o">-</span> <span class="nv">redisinsight</span>:<span class="o">/</span><span class="nv">db</span>

<span class="nv">volumes</span>:
  <span class="nv">redis</span><span class="o">-</span><span class="nv">data</span>:
  <span class="nv">redisinsight</span>:
</code></pre></div>

<p>The above <code>docker-compose</code> file has two services, <code>redis</code> and <code>redisinsight</code>. I've set
up the database with a dummy password <code>ubuntu</code> and made it persistent using a folder
named <code>redis-data</code> in the current working directory. The database listens in localhost's
port <code>6379</code>. You can monitor the database using <code>redisinsight</code> in port 8000. To spin up
Redis and RedisInsight containers, run:</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>

<p>This command will start the database and monitor accordingly. You can go to this
<code>localhost:8000</code> link using your browser and connect redisinsight to your database.
After connecting your database, you should see a dashboard like this in your
redisinsight panel:</p>
<p><img alt="Screenshot from 2020-05-23 19-23-21" src="https://user-images.githubusercontent.com/30027932/82731781-f30b1b00-9d2a-11ea-8c72-62a4753bc5f9.png" /></p>
<h2>Preparing Python environment</h2>
<p>For local development, you can set up your python environment and install the
dependencies using pip. Here, I'm on a Linux machine and using virtual environment for
isolation. The following commands will work if you're on a *nix based system and have
<code>python 3.8</code> installed on your system. This will install the necessary dependencies in a
virtual environment:</p>
<div class="highlight"><pre><span></span><code>python3.10 -m venv .venv
<span class="nb">source</span> .venv/bin/activate
pip install redis httpx
</code></pre></div>

<h2>Workflow</h2>
<h3>Connecting Python client to Redis</h3>
<p>Assuming the database server is running and you've installed the dependencies, the
following snippet connects <code>redis-py</code> client to the database.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">redis</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="k">def</span> <span class="nf">redis_connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span>
            <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">socket_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ping</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ping</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">client</span>
    <span class="k">except</span> <span class="n">redis</span><span class="o">.</span><span class="n">AuthenticationError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AuthenticationError&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">redis_connect</span><span class="p">()</span>
</code></pre></div>

<p>The above excerpt tries to connect to the <code>Redis</code> database server using the port <code>6379</code>.
Notice, how I'm providing the password <code>ubuntu</code> via the <code>password</code> argument. Here,
<code>client.ping()</code> helps you determine if a connection has been established successfully.
It returns <code>True</code> if a successful connection can be established or raises specific
errors in case of failures. The above function handles <code>AuthenticationError</code> and prints
out an error message if the error occurs. If everything goes well, running the
<code>redis_connect()</code> function will return an instance of the <code>redis.client.Redis</code> class.
This instance will be used later to set and retrieve data to and from the redis database.</p>
<h3>Getting route data from MapBox API</h3>
<p>The following function strikes the MapBox Route Optimization API and collects route data.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">httpx</span>


<span class="k">def</span> <span class="nf">get_routes_from_api</span><span class="p">(</span><span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Data from mapbox api.&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.mapbox.com/optimized-trips/v1/mapbox/driving&quot;</span>

        <span class="n">geometries</span> <span class="o">=</span> <span class="s2">&quot;geojson&quot;</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="s2">&quot;Your-MapBox-API-token&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">coordinates</span><span class="si">}</span><span class="s2">?geometries=</span><span class="si">{</span><span class="n">geometries</span><span class="si">}</span><span class="s2">&amp;access_token=</span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div>

<p>The above code uses Python's <a href="https://github.com/encode/httpx">httpx</a> library to make
the get request. Httpx is almost a drop-in replacement for the ubiquitous
<a href="https://github.com/psf/requests">Requests</a> library but way faster and has async
support. Here, I've used context manager <code>httpx.Client()</code> for better resource management
while making the <code>get</code> request. You can read more about context managers and how to use
them for hassle free resource management
<a href="https://rednafi.github.io/digressions/python/2020/03/26/python-contextmanager.html">here</a>.</p>
<p>The <code>base_url</code> is the base url of the route optimization API and the you'll need to
provide your own access token in the <code>access_token</code> field. Notice, how the <code>url</code>
variable builds up the final request url. The <code>coordinates</code> are provided using the
<code>lat0,lon0;lat1,lon1;lat2,lon2...</code> format. Rest of the function sends the http requests
and converts the response into a native dictionary object using the <code>response.json()</code>
method.</p>
<h3>Setting &amp; retrieving data to &amp; from Redis database</h3>
<p>The following two functions retrieves data from and sets data to redis database
respectively.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>


<span class="k">def</span> <span class="nf">get_routes_from_cache</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get data from redis.&quot;&quot;&quot;</span>

    <span class="n">val</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>


<span class="k">def</span> <span class="nf">set_routes_to_cache</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Set data to redis.&quot;&quot;&quot;</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span>
        <span class="n">key</span><span class="p">,</span>
        <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div>

<p>Here, both the keys and the values are strings. In the second function,
<code>set_routes_to_cache</code>, the <code>client.setex()</code> method sets a timeout of 1 hour on the key.
After that the key and its associated value get deleted automatically.</p>
<h3>The central orchestration</h3>
<p>The <code>route_optima</code> function is the primary agent that orchestrates and executes the
caching and returning of responses against requests. It roughly follows the execution
flow shown below.</p>
<p><img alt="redis-cache" src="https://user-images.githubusercontent.com/30027932/82735908-1ba10e00-9d47-11ea-9e86-ac1fbc63628f.png" /></p>
<p>When a new request arrives, the function first checks if the return-value exists in the
Redis cache. If the value exists, it shows the cached value, otherwise, it sends a new
request to the MapBox API, cache that value and then shows the result.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">route_optima</span><span class="p">(</span><span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

    <span class="c1"># First it looks for the data in redis cache</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_routes_from_cache</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">coordinates</span><span class="p">)</span>

    <span class="c1"># If cache is found then serves the data from cache</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cache&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If cache is not found then sends request to the MapBox API</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_routes_from_api</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

        <span class="c1"># This block sets saves the respose to redis and serves it directly</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Ok&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cache&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">set_routes_to_cache</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div>

<h3>Exposing as an API</h3>
<p>This part of the code wraps the original Route Optimization API and exposes that as a
new endpoint. I've used <a href="https://fastapi.tiangolo.com/">fastAPI</a> to build the wrapper
API. Doing this also hides the underlying details of authentication and the actual
endpoint of the MapBox API.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/route-optima/</span><span class="si">{coordinates}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This will wrap our original route optimization API and</span>
<span class="sd">    incorporate Redis Caching. You&#39;ll only expose this API to</span>
<span class="sd">    the end user.&quot;&quot;&quot;</span>

    <span class="c1"># coordinates = &quot;90.3866,23.7182;90.3742,23.7461&quot;</span>

    <span class="k">return</span> <span class="n">route_optima</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</code></pre></div>

<h3>Putting it all together</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># app.py</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>

<span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">redis</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>


<span class="k">def</span> <span class="nf">redis_connect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">redis</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Redis</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span>
            <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">socket_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ping</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ping</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">client</span>
    <span class="k">except</span> <span class="n">redis</span><span class="o">.</span><span class="n">AuthenticationError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AuthenticationError&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="n">client</span> <span class="o">=</span> <span class="n">redis_connect</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_routes_from_api</span><span class="p">(</span><span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Data from mapbox api.&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.mapbox.com/optimized-trips/v1/mapbox/driving&quot;</span>

        <span class="n">geometries</span> <span class="o">=</span> <span class="s2">&quot;geojson&quot;</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="s2">&quot;Your-MapBox-API-token&quot;</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">coordinates</span><span class="si">}</span><span class="s2">?geometries=</span><span class="si">{</span><span class="n">geometries</span><span class="si">}</span><span class="s2">&amp;access_token=</span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">get_routes_from_cache</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Data from redis.&quot;&quot;&quot;</span>

    <span class="n">val</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val</span>


<span class="k">def</span> <span class="nf">set_routes_to_cache</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Data to redis.&quot;&quot;&quot;</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span>
        <span class="n">key</span><span class="p">,</span>
        <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>


<span class="k">def</span> <span class="nf">route_optima</span><span class="p">(</span><span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

    <span class="c1"># First it looks for the data in redis cache</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">get_routes_from_cache</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">coordinates</span><span class="p">)</span>

    <span class="c1"># If cache is found then serves the data from cache</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cache&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If cache is not found then sends request to the MapBox API</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">get_routes_from_api</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

        <span class="c1"># This block sets saves the respose to redis and serves it directly</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Ok&quot;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cache&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">set_routes_to_cache</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/route-optima/</span><span class="si">{coordinates}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="n">coordinates</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This will wrap our original route optimization API and</span>
<span class="sd">    incorporate Redis Caching. You&#39;ll only expose this API to</span>
<span class="sd">    the end user.&quot;&quot;&quot;</span>

    <span class="c1"># coordinates = &quot;90.3866,23.7182;90.3742,23.7461&quot;</span>

    <span class="k">return</span> <span class="n">route_optima</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</code></pre></div>

<p>You can copy the complete code to a file named <code>app.py</code> and run the app using the
command below (assuming redis, redisinsight is running and you've installed the
dependencies beforehand):</p>
<div class="highlight"><pre><span></span><code><span class="n">uvicorn</span><span class="w"> </span><span class="n">app</span><span class="o">.</span><span class="n">app</span><span class="p">:</span><span class="n">app</span><span class="w"> </span><span class="o">--</span><span class="n">host</span><span class="w"> </span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="o">--</span><span class="n">port</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="o">--</span><span class="n">reload</span><span class="w"></span>
</code></pre></div>

<p>This will run a local server where you can send new request with coordinates.</p>
<p>Go to your browser and hit the endpoint with a set of new coordinates. For example:</p>
<div class="highlight"><pre><span></span><code><span class="nt">http</span><span class="o">://</span><span class="nt">localhost</span><span class="p">:</span><span class="nd">5000</span><span class="o">/</span><span class="nt">route-optima</span><span class="o">/</span><span class="nt">90</span><span class="p">.</span><span class="nc">3866</span><span class="o">,</span><span class="nt">23</span><span class="p">.</span><span class="nc">7182</span><span class="o">;</span><span class="nt">90</span><span class="p">.</span><span class="nc">3742</span><span class="o">,</span><span class="nt">23</span><span class="p">.</span><span class="nc">7461</span><span class="w"></span>
</code></pre></div>

<p>This should return a response with the coordinates of the optimized route.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="s2">&quot;Ok&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;waypoints&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="mf">26.041809241776583</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;location&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">            </span><span class="mf">90.386855</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="mf">23.718213</span><span class="w"></span>
<span class="w">         </span><span class="p">],</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;waypoint_index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;trips_index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="mf">6.286653078791968</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;location&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">            </span><span class="mf">90.374253</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="mf">23.746129</span><span class="w"></span>
<span class="w">         </span><span class="p">],</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;waypoint_index&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;trips_index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">],</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;trips&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;geometry&quot;</span><span class="p">:{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;coordinates&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">               </span><span class="p">[</span><span class="w"></span>
<span class="w">                  </span><span class="mf">90.386855</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="mf">23.718213</span><span class="w"></span>
<span class="w">               </span><span class="p">],</span><span class="w"></span>
<span class="w">               </span><span class="s2">&quot;...</span>
<span class="s2">...&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">],</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;LineString&quot;</span><span class="w"></span>
<span class="w">         </span><span class="p">},</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;legs&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="mf">3303.1</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="mf">2842.8</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;steps&quot;</span><span class="p">:[</span><span class="w"></span>

<span class="w">               </span><span class="p">],</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="mf">5250.2</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="mf">2536.5</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="mi">2297</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;steps&quot;</span><span class="p">:[</span><span class="w"></span>

<span class="w">               </span><span class="p">],</span><span class="w"></span>
<span class="w">               </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="mf">4554.8</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">         </span><span class="p">],</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;weight_name&quot;</span><span class="p">:</span><span class="s2">&quot;routability&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;weight&quot;</span><span class="p">:</span><span class="mf">5839.6</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="mf">5139.8</span><span class="p">,</span><span class="w"></span>
<span class="w">         </span><span class="nt">&quot;distance&quot;</span><span class="p">:</span><span class="mi">9805</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">],</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;cache&quot;</span><span class="p">:</span><span class="kc">false</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>If you've hit the above URL for the first time, the <code>cache</code> attribute of the json
response should show <code>false</code>. This means that the response is being served from the
original MapBox API. However, hitting the same URL with the same coordinates again will
show the cached response and this time the <code>cache</code> attribute should show <code>true</code>.</p>
<h2>Inspection</h2>
<p>Once you've got everything up and running you can inspect the cache via redis insight.
To do so, go to the link below while your app server is running:</p>
<div class="highlight"><pre><span></span><code>http://localhost:8000/
</code></pre></div>

<p>Select the <code>Browser</code> panel from the left menu and click on a key of your cached data. It
should show something like this:</p>
<p><img alt="Screenshot from 2020-05-25 02-06-24" src="https://user-images.githubusercontent.com/30027932/82763854-6a74a380-9e2c-11ea-998d-066d25461eca.png" /></p>
<p>Also you can play around with the API in the swagger UI. To do so, go to the following
link:</p>
<div class="highlight"><pre><span></span><code>http://localhost:5000/docs
</code></pre></div>

<p>This will take you to the swagger dashboard. Here you can make requests using the
interactive UI. Go ahead and inspect how the caching works for new coordinates.</p>
<p><img alt="swagger" src="https://user-images.githubusercontent.com/30027932/82763965-2f26a480-9e2d-11ea-906b-63c1d25c08a8.png" /></p>
<h2>Remarks</h2>
<p>You can find the complete source code of the app <a href="https://github.com/rednafi/redis-request-caching">here</a>.</p>
<h2>Disclaimer</h2>
<p>This app has been made for demonstration purpose only. So it might not reflect the best
practices of production ready applications. Using APIs without authentication like this
is not recommended.</p>
<h2>Resources</h2>
<ul>
<li><a href="https://github.com/rednafi/redis-request-caching">Http request caching with Redis</a></li>
<li><a href="https://github.com/encode/httpx/">Httpx</a></li>
<li><a href="https://redis.io/">Redis</a></li>
<li><a href="https://redislabs.com/redisinsight/">RedisInsight</a></li>
<li><a href="https://github.com/tiangolo/fastapi">FastAPI</a></li>
</ul>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-05-25T00:00:00+06:00">Mon 25 May 2020</time>
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#api-ref">API
                    <span class="superscript">2</span>
</a></li>
                <li><a href="./tags.html#python-ref">Python
                    <span class="superscript">58</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="mailto:redowan.nafi@gmail.com" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#328cff"/><path d="m250 186c-46 0-69 35-69 74 0 44 29 72 68 72 43 0 73-32 73-75 0-44-34-71-72-71zm-1-37c30 0 57 13 77 33 0-22 35-22 35 1v150c-1 10 10 16 16 9 25-25 54-128-14-187-64-56-149-47-195-15-48 33-79 107-49 175 33 76 126 99 182 76 28-12 41 26 12 39-45 19-168 17-225-82-38-68-36-185 67-248 78-46 182-33 244 32 66 69 62 197-2 246-28 23-71 1-71-32v-11c-20 20-47 32-77 32-57 0-108-51-108-108 0-58 51-110 108-110" fill="#fff"/></svg>
    </a>
    <a href="https://github.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://twitter.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://www.goodreads.com/user/show/53485837-redowan-delowar" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><rect fill="#EAE6CF" height="512" rx="64" width="512"/><path d="m254.92444 336.92444c43.2889-.36 74.07112-22.01333 92.33334-64.95111h.95556v65.48889c0 4.88-.32 12.44889-.95556 22.73333-1.30222 10.64445-4.78222 22.10223-10.42666 34.36889-5.65778 11.54667-14.79112 21.38667-27.37778 29.49778-12.44889 8.84-29.81778 13.44-52.12001 13.80444-21.48444 0-39.65333-5.59555-54.52444-16.77777-15.2-11.00889-24.08001-28.87111-26.65778-53.58667h-18.89778c1.93778 32.11111 12.18667 55.02667 30.76444 68.74222 18.08889 13.16445 41.04001 19.75556 68.83556 19.75556 27.45778 0 48.87112-5.14223 64.21778-15.43111 15.18223-9.92 26.08445-22.28445 32.71556-37.08 6.62222-14.79111 10.58222-28.86667 11.86667-42.21334.98222-13.35555 1.45778-22.91555 1.45778-28.68889v-270.088875h-18.90667v59.537775h-.95556c-7.27555-21.82667-19.30666-38.333335-36.12-49.524445-16.96-11.00445-35.70222-16.51111-56.21333-16.51111-35.72001.72444-62.85779 14.52444-81.43112 41.40889-19.07111 26.697775-28.59556 59.631105-28.59556 98.782195 0 40.23557 9.04445 73.52001 27.13334 99.86224 18.27555 26.88889 45.89778 40.51111 82.90222 40.87111zm-68.34222-224.89777c14.85333-24.359995 37.63111-36.986665 68.34222-37.888885 31.50223.90666 54.83556 13.17333 70.03556 36.808885 15.18223 23.64 22.77778 52.05331 22.77778 85.25331s-7.59555 61.43112-22.77778 84.70668c-15.2 24.72444-38.53333 37.34667-70.03556 37.88889-29.72889-.54667-52.36-12.81778-67.86222-36.80889-15.67556-23.27556-23.50667-51.87112-23.50667-85.79112-.004-31.75556 7.67111-59.81332 23.02667-84.16887z" fill="#743901"/></svg>
    </a>
    <a href="/reflections/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>



    <div id="fpowered">

            © 2020-2022 • Redowan Delowar • All Rights Reserved


    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>