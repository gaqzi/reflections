<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="google-site-verification" content="<meta name='google-site-verification' content='N5QEPRj-LpgoEY0Hf3uVMmZq8kjDwTFjd54IgvLmRBc' />" />        <meta name="author" content="Redowan Delowar" />

        <meta name="description" content="While working with microservices in Python, a common pattern that I see is—the usage of dynamically filled dictionaries as payloads of REST APIs or message queues. To understand what I mean by this, consider the following example: # src.py from __future__ import annotations import json from typing import Any …
" />
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Python, Typing, python, " />

<meta property="og:title" content="Declarative payloads with TypedDict in Python "/>
<meta property="og:url" content="./declarative-payloads-with-typeddict-in-python.html" />
<meta property="og:description" content="While working with microservices in Python, a common pattern that I see is—the usage of dynamically filled dictionaries as payloads of REST APIs or message queues. To understand what I mean by this, consider the following example: # src.py from __future__ import annotations import json from typing import Any …" />
<meta property="og:site_name" content="Redowan&#39;s Reflections" />
<meta property="og:article:author" content="Redowan Delowar" />
<meta property="og:article:published_time" content="2022-03-11T00:00:00+06:00" />
<meta name="twitter:title" content="Declarative payloads with TypedDict in Python ">
<meta name="twitter:description" content="While working with microservices in Python, a common pattern that I see is—the usage of dynamically filled dictionaries as payloads of REST APIs or message queues. To understand what I mean by this, consider the following example: # src.py from __future__ import annotations import json from typing import Any …">
<meta property="og:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" />
<meta name="twitter:image" content="https://user-images.githubusercontent.com/30027932/149235389-c6b85b40-5515-4de4-a922-7b0f91efd0cf.png" >

        <title>Declarative payloads with TypedDict in Python  · Redowan&#39;s Reflections
</title>
        <link href="https://rednafi.github.io/reflections/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Redowan&#39;s Reflections - Full Atom Feed" />

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-217287505-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>Redowan's Reflections</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       .
                                    >Home</a>
                                </li>
                                <li ><a href="./pages/contact.html">Contact</a></li>
                                <li ><a href="./categories.html">Categories</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li ><a href="./archives.html">Archives</a></li>
                                <li>
                                  <form action="https://www.google.com/search" class="navbar-search" method="get" name="searchform" target="_blank">
                                    <input name="sitesearch" type="hidden"
                                    value="rednafi.github.io/reflections">
                                    <input autocomplete="on" class="search-query" name="q" placeholder="Search"
                                    required="required"  type="text">
                                    <input type="submit" value="Search" style="visibility: hidden;" /></form>
                                  </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./declarative-payloads-with-typeddict-in-python.html">
                Declarative payloads with TypedDict in Python
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>While working with microservices in Python, a common pattern that I see is—the usage of
dynamically filled dictionaries as payloads of REST APIs or message queues. To
understand what I mean by this, consider the following example:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># src.py</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">import</span> <span class="nn">redis</span>  <span class="c1"># Do a pip install.</span>


<span class="k">def</span> <span class="nf">get_payload</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get the &#39;zoo&#39; payload containing animal names and attributes.&quot;&quot;&quot;</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;awesome_zoo&quot;</span><span class="p">,</span> <span class="s2">&quot;animals&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;wolf&quot;</span><span class="p">,</span> <span class="s2">&quot;snake&quot;</span><span class="p">,</span> <span class="s2">&quot;ostrich&quot;</span><span class="p">)</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Canidae&quot;</span><span class="p">,</span> <span class="s2">&quot;genus&quot;</span><span class="p">:</span> <span class="s2">&quot;Canis&quot;</span><span class="p">,</span> <span class="s2">&quot;is_mammal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Viperidae&quot;</span><span class="p">,</span> <span class="s2">&quot;genus&quot;</span><span class="p">:</span> <span class="s2">&quot;Boas&quot;</span><span class="p">,</span> <span class="s2">&quot;is_mammal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;animals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">payload</span>


<span class="k">def</span> <span class="nf">save_to_cache</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># You&#39;ll need to spin up a Redis db before instantiating</span>
    <span class="c1"># a connection here.</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving to cache...&quot;</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;zoo:</span><span class="si">{</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">get_payload</span><span class="p">()</span>
    <span class="n">save_to_cache</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div>

<p>Here, the <code>get_payload</code> function constructs a payload that gets stored in a Redis DB in
the <code>save_to_cache</code> function. The <code>get_payload</code> function returns a dict that denotes a
contrived payload containing the data of an imaginary zoo. To execute the above snippet,
you'll need to spin up a Redis database first. You can use
<a href="https://www.docker.com/">Docker</a> to do so. Install and configure Docker on your system
and run:</p>
<div class="highlight"><pre><span></span><code>docker run -d -p 6379:6379 redis:alpine
</code></pre></div>

<p>If you run the above snippet after instantiating the Redis server, it'll run without
raising any error. You can inspect the content saved in Redis with the following command
(assuming you've got <code>redis-cli</code> and <code>jq</code> installed in your system):</p>
<div class="highlight"><pre><span></span><code>echo &quot;get zoo:awesome_zoo&quot; | redis-cli | jq
</code></pre></div>

<p>This will return the following payload to your console:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;awesome_zoo&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;animals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;wolf&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;attribute&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;family&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Canidae&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;genus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Canis&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;is_mammal&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;snake&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;attribute&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;family&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Viperidae&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;genus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Boas&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;is_mammal&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Although this workflow is functional in runtime, there's a big gotcha here! It's really
difficult to picture the shape of the <code>payload</code> from the output of the <code>get_payload</code>
function; as it dynamically builds the dictionary. First, it declares a dictionary with
two fields—<code>name</code> and <code>animals</code>. Here, <code>name</code> is a string value that denotes the name of
the zoo. The other field <code>animals</code> is a list containing the names and attributes of the
animals in the zoo. Later on, the for-loop fills up the dictionary with nested data
structures. This charade of operations makes it difficult to reify the final shape of
the resulting <code>payload</code> in your mind.</p>
<p>In this case, you'll have to inspect the content of the Redis cache to fully understand
the shape of the data. Writing code in the above manner is effortless but it makes it
really hard for the next person working on the codebase to understand how the payload
looks without tapping into the data storage. There's a better way to declaratively
communicate the shape of the payload that doesn't involve writing unmaintainably large
docstrings. Here's how you can leverage <code>TypedDict</code> and <code>Annotated</code> to achieve the goals:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># src.py</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># In &lt; Python 3.8, import &#39;TypedDict&#39; from &#39;typing_extensions&#39;.</span>
<span class="c1"># In &lt; Python 3.9, import &#39;Annotated&#39; from &#39;typing_extensions&#39;.</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TypedDict</span>

<span class="kn">import</span> <span class="nn">redis</span>  <span class="c1"># Do a pip install.</span>


<span class="k">class</span> <span class="nc">Attribute</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">family</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">genus</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_mammal</span><span class="p">:</span> <span class="nb">bool</span>


<span class="k">class</span> <span class="nc">Animal</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">attribute</span><span class="p">:</span> <span class="n">Attribute</span>


<span class="k">class</span> <span class="nc">Zoo</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">animals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Animal</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">get_payload</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Zoo</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the &#39;zoo&#39; payload containing animal names and attributes.&quot;&quot;&quot;</span>

    <span class="n">payload</span><span class="p">:</span> <span class="n">Zoo</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;awesome_zoo&quot;</span><span class="p">,</span> <span class="s2">&quot;animals&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;wolf&quot;</span><span class="p">,</span> <span class="s2">&quot;snake&quot;</span><span class="p">,</span> <span class="s2">&quot;ostrich&quot;</span><span class="p">)</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Attribute</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Canidae&quot;</span><span class="p">,</span> <span class="s2">&quot;genus&quot;</span><span class="p">:</span> <span class="s2">&quot;Canis&quot;</span><span class="p">,</span> <span class="s2">&quot;is_mammal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Viperidae&quot;</span><span class="p">,</span> <span class="s2">&quot;genus&quot;</span><span class="p">:</span> <span class="s2">&quot;Boas&quot;</span><span class="p">,</span> <span class="s2">&quot;is_mammal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;animals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;attribute&quot;</span><span class="p">:</span> <span class="n">attr</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">payload</span>


<span class="k">def</span> <span class="nf">save_to_cache</span><span class="p">(</span><span class="n">payload</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">Zoo</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># You&#39;ll need to spin up a Redis db before instantiating</span>
    <span class="c1"># a connection here.</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving to cache...&quot;</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;zoo:</span><span class="si">{</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">Zoo</span> <span class="o">=</span> <span class="n">get_payload</span><span class="p">()</span>
    <span class="n">save_to_cache</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div>

<p>Notice, how I've used <code>TypedDict</code> to declare the nested structure of the payload <code>Zoo</code>.
In runtime, instances of typed-dict classes behave the same way as normal dicts. Here,
<code>Zoo</code> contains two fields—<code>name</code> and <code>animals</code>. The <code>animals</code> field is annotated as
<code>list[Animal]</code> where <code>Animal</code> is another typed-dict. The <code>Animal</code> typed-dict houses
another typed-dict called <code>Attribute</code> that defines various properties of the animal.</p>
<p>Taking a look at the typed-dict <code>Zoo</code> and following along its nested structure, the
final shape of the payload becomes clearer without us having to look for example
payloads. Also, Mypy can check whether the payload conforms to the shape of the
annotated type. I used <code>Annotated[Zoo, dict]</code> in the input parameter of <code>save_to_cache</code>
function to communicate with the reader that an instance of the class <code>Zoo</code> is a dict
that conforms to the contract laid out in the type itself. The type <code>Annotated</code> can be
used to add any arbitrary metadata to a particular type.</p>
<p>In runtime, this snippet will exhibit the same behavior as the previous one. Mypy also
approves this.</p>
<h2>Handling missing key-value pairs</h2>
<p>By default, the type checker will structurally validate the shape of the dict annotated
with a <code>TypedDict</code> class and all the key-value pairs expected by the annotation must be
present in the dict. It's possible to lax this behavior by specifying <em>totality</em>. This
can be helpful to deal with missing fields without letting go of type safety. Consider
this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>


<span class="k">class</span> <span class="nc">Attribute</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">family</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">genus</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_mammal</span><span class="p">:</span> <span class="nb">bool</span>


<span class="n">animal_attribute</span><span class="p">:</span> <span class="n">Attribute</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="s2">&quot;Hominidae&quot;</span><span class="p">,</span>
    <span class="s2">&quot;genus&quot;</span><span class="p">:</span> <span class="s2">&quot;Homo&quot;</span><span class="p">,</span>
<span class="p">}</span>  <span class="c1"># Mypy will complain about the missing &#39;is_mammal&#39; key.</span>
</code></pre></div>

<p>Mypy will complain about the missing key:</p>
<div class="highlight"><pre><span></span><code><span class="nv">src</span>.<span class="nv">py</span>:<span class="mi">12</span>: <span class="nv">error</span>: <span class="nv">Missing</span> <span class="nv">key</span> <span class="s2">&quot;</span><span class="s">is_mammal</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nv">TypedDict</span> <span class="s2">&quot;</span><span class="s">Attribute</span><span class="s2">&quot;</span>
    <span class="nv">animal_attribute</span>: <span class="nv">Attribute</span> <span class="o">=</span> {
                                  <span class="o">^</span>
<span class="nv">Found</span> <span class="mi">1</span> <span class="nv">error</span> <span class="nv">in</span> <span class="mi">1</span> <span class="nv">file</span> <span class="ss">(</span><span class="nv">checked</span> <span class="mi">1</span> <span class="nv">source</span> <span class="nv">file</span><span class="ss">)</span>
</code></pre></div>

<p>You can relax this behavior like this:</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>


<span class="k">class</span> <span class="nc">Attribute</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">family</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">genus</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">is_mammal</span><span class="p">:</span> <span class="nb">bool</span>


<span class="o">...</span>
</code></pre></div>

<p>Now Mypy will no longer complain about the missing field in the annotated dict. However,
this will still disallow arbitrary keys that isn't defined in the <code>TypedDict</code>. For
example:</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>

<span class="c1"># Mypy will complain as the key &#39;species&#39; doesn&#39;t exist in the TypedDict.</span>
<span class="n">animal_attribute</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Sapiens&quot;</span>

<span class="o">...</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>src.py:17: error: TypedDict &quot;Attribute&quot; has no key &quot;species&quot;
    animal_attribute[&quot;species&quot;] = &quot;Sapiens&quot;
                    ^
Found 1 error in 1 file (checked 3 source files)
make: *** [Makefile:134: mypy] Error 1
</code></pre></div>

<p>Sweet type safety without being too strict about missing fields!</p>
<h2>References</h2>
<ul>
<li><a href="https://peps.python.org/pep-0589/">PEP 589 – TypedDict: Type hints for dictionaries with a fixed set of keys</a></li>
</ul>


             
 
            
            
            







            <hr/>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2022-03-11T00:00:00+06:00">Fri 11 March 2022</time>
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#python-ref">python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#python-ref">Python
                    <span class="superscript">58</span>
</a></li>
                <li><a href="./tags.html#typing-ref">Typing
                    <span class="superscript">9</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
    <a href="mailto:redowan.nafi@gmail.com" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Mail" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#328cff"/><path d="m250 186c-46 0-69 35-69 74 0 44 29 72 68 72 43 0 73-32 73-75 0-44-34-71-72-71zm-1-37c30 0 57 13 77 33 0-22 35-22 35 1v150c-1 10 10 16 16 9 25-25 54-128-14-187-64-56-149-47-195-15-48 33-79 107-49 175 33 76 126 99 182 76 28-12 41 26 12 39-45 19-168 17-225-82-38-68-36-185 67-248 78-46 182-33 244 32 66 69 62 197-2 246-28 23-71 1-71-32v-11c-20 20-47 32-77 32-57 0-108-51-108-108 0-58 51-110 108-110" fill="#fff"/></svg>
    </a>
    <a href="https://github.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://twitter.com/rednafi" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
    <a href="https://www.goodreads.com/user/show/53485837-redowan-delowar" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg height="512" viewBox="0 0 512 512" width="512" xmlns="http://www.w3.org/2000/svg"><rect fill="#EAE6CF" height="512" rx="64" width="512"/><path d="m254.92444 336.92444c43.2889-.36 74.07112-22.01333 92.33334-64.95111h.95556v65.48889c0 4.88-.32 12.44889-.95556 22.73333-1.30222 10.64445-4.78222 22.10223-10.42666 34.36889-5.65778 11.54667-14.79112 21.38667-27.37778 29.49778-12.44889 8.84-29.81778 13.44-52.12001 13.80444-21.48444 0-39.65333-5.59555-54.52444-16.77777-15.2-11.00889-24.08001-28.87111-26.65778-53.58667h-18.89778c1.93778 32.11111 12.18667 55.02667 30.76444 68.74222 18.08889 13.16445 41.04001 19.75556 68.83556 19.75556 27.45778 0 48.87112-5.14223 64.21778-15.43111 15.18223-9.92 26.08445-22.28445 32.71556-37.08 6.62222-14.79111 10.58222-28.86667 11.86667-42.21334.98222-13.35555 1.45778-22.91555 1.45778-28.68889v-270.088875h-18.90667v59.537775h-.95556c-7.27555-21.82667-19.30666-38.333335-36.12-49.524445-16.96-11.00445-35.70222-16.51111-56.21333-16.51111-35.72001.72444-62.85779 14.52444-81.43112 41.40889-19.07111 26.697775-28.59556 59.631105-28.59556 98.782195 0 40.23557 9.04445 73.52001 27.13334 99.86224 18.27555 26.88889 45.89778 40.51111 82.90222 40.87111zm-68.34222-224.89777c14.85333-24.359995 37.63111-36.986665 68.34222-37.888885 31.50223.90666 54.83556 13.17333 70.03556 36.808885 15.18223 23.64 22.77778 52.05331 22.77778 85.25331s-7.59555 61.43112-22.77778 84.70668c-15.2 24.72444-38.53333 37.34667-70.03556 37.88889-29.72889-.54667-52.36-12.81778-67.86222-36.80889-15.67556-23.27556-23.50667-51.87112-23.50667-85.79112-.004-31.75556 7.67111-59.81332 23.02667-84.16887z" fill="#743901"/></svg>
    </a>
    <a href="/reflections/feeds/all.atom.xml" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="RSS" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#f80"/><circle cx="145" cy="367" r="35" fill="#fff"/><path fill="none" stroke="#fff" stroke-width="60" d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>



    <div id="fpowered">

            © 2020-2022 • Redowan Delowar • All Rights Reserved


    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>